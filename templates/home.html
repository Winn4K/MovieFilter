<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/styles.css">
    <title>Movie Filter</title>

    <!-- Importando Jquery -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
    <!-- função de autocomplete -->
    <script>
        $(function () {
            $(".movies").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "http://localhost:5000/autocomplete",
                        data: {
                            q: request.term
                        },
                        success: function (data) {
                            response(data);
                        }
                    });
                },
                minLength: 1,
            });
        });
    </script>

</head>

<body>

    <!-- Titulo -->
    <h1 class="titulo">Movie Filter</h1>

    <!-- Container que envolve o botão de enviar o formulario, e o containerImgInput que contém os posters e os campos de seleção dos filmes -->
    <div class="container" id="containerGeral">

        <!-- Formulario de envio dos filmes selecionados -->
        <form class="formFilters" action="/submit" method="post"></form>

            <!-- Container que contém os pôsters, inputs e as flechas -->
            <div class="container" id="containerImgInput">

                <!-- Container que contém o poster do primeiro filme e o campo de pesquisa do primeiro filme -->
                <div class="boxImgInput">
                    <!-- Container que contém o poster do primeiro filme -->
                    <div class="banner">
                        <img src="../static/imgs/FirstMovieImg.png" alt="Pôster do Filme" class="image" id="imageLeft">
                    </div>
                    <!-- Container que contém o campo de pesquisa do primeiro filme -->
                    <div class="campoBox">
                        <label for="firstMovie"><span>Digite o primeiro filme</span></label>
                        <input type="text" class="movies" id="firstMovie" name="firstMovie" autocomplete="on" required />
                    </div>
                </div>

                <!-- Flecha esquerda apontando para a direita -->
                <div class="boxArrow">
                    <div class="arrow" id="arrowLeft">
                    </div>
                </div>

                <!-- Container que contém o poster do filme sugerido e o campo ReadOnly que contem o titulo do filme sugerido -->
                <div class="boxImgInput">
                    <div class="banner">
                        <div class="image" id="imageCenter">
                        </div>
                    </div>
                    <div class="campoBox" id="boxSugestedMovie">
                        <label for="SugestMovie"><span>Filme sugerido</span></label>
                        <input type="text" id="SugestMovie" name="SugestMovie" autocomplete="off" value="{{ filme_return }}" readonly />
                    </div>
                </div>

                <!-- Flecha direita apontando para a esquerda -->
                <div class="boxArrow">
                    <div class="arrow" id="arrowRight">
                    </div>
                </div>
                
                <!-- Container que contém o poster do primeiro filme e o campo de pesquisa do primeiro filme -->
                <div class="boxImgInput">
                    <!-- Container que contém o poster do segundo filme -->
                    <div class="banner">
                        <img src="../static/imgs/SecondMovieImg.png" alt="Pôster do Filme" class="image" id="imageRight">
                    </div>
                    <!-- Container que contém o campo de pesquisa do segundo filme -->
                    <div class="campoBox">
                        <label for="secondMovie"><span>Digite o segundo filme</span></label>
                        <input type="text" class="movies" id="secondMovie" name="secondMovie" autocomplete="on" required />
                    </div>
                </div>
                
            </div>
            <!-- Container que contém o botão de enviar -->
            <div class="boxSubmit">
                <input type="submit" value="Gerar">
            </div>
        </form>
    
    </div>

    <!-- função que atualiza os posters assim que o usuario seleciona o filme e troca de campo -->
    <script>
        $(document).ready(function () {
            function updateImage(inputId, imageId) {
                $(`#${inputId}`).on('change', function () {
                    var texto = $(this).val();
                    $.ajax({
                        url: '/meu_form/' + inputId,
                        data: { [inputId]: texto },
                        type: 'POST',
                        success: function (response) {
                            // Atualiza a imagem com a URL do pôster retornada pela API
                            document.getElementById(imageId).src = response.poster_url;
                        },
                        error: function (error) {
                            console.log(error);
                        }
                    });
                });
            }

            updateImage('firstMovie', 'imageLeft');
            updateImage('secondMovie', 'imageRight');
        });
    </script>
</body>

</html>